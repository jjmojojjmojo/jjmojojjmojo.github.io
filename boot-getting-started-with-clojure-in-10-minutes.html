<!DOCTYPE html>
<html lang="en">
<head>
          <title>The Collected Works of jjmojojjmojo</title>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link rel="stylesheet" type="text/css" href="/theme/css/main.css" />
        <link id="highlight-css" rel="stylesheet" type="text/css" href="/theme/css/syntax-solarized-light.css" />
        <script src="/theme/js/zepto.min.js"></script>


    <meta name="tags" content="boot" />
    <meta name="tags" content="clojure" />

</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/"><img id="header-home-icon" src="/theme/icons/home.svg"> <span id="header-site-title">The Collected Works of jjmojojjmojo <strong></strong></span></a></h1>
                <ul id="menu">
                    <li><a href="/pages/about.html">About</a></li>
                    <li><a href="/pages/contact.html">Contact</a></li>
                    <li><a href="/pages/index.html">Pages</a></li>
                    <li><a href="/categories.html">Categories</a></li>
                    <li><a href="/tags.html">Tags</a></li>
                </ul>
                <span id="settings-button">
                    <a href="/pages/settings.html" title="Settings">
                        <img src="/theme/icons/settings.svg" alt="Gear Icon For Settings">
                    </a>
                </span>
        </header><!-- /#banner -->
        <div id="content-wrapper">
<section id="content" class="body">
  <header>
    <h2 class="entry-title">
      <a href="/boot-getting-started-with-clojure-in-10-minutes.html" rel="bookmark"
         title="Permalink to Boot: Getting Started With Clojure In < 10 Minutes">Boot: Getting Started With Clojure In &lt; 10 Minutes</a></h2>
 
  </header>
  <footer class="post-info">
    <time class="published" datetime="2018-08-01T11:41:00-04:00">
      Wed 01 August 2018
    </time>
    <address class="vcard author">
      By           <a class="url fn" href="/author/jjmojojjmojo.html">jjmojojjmojo</a>
    </address>
  </footer><!-- /.post-info -->
    <div>
        <div id="toc"><ul><li><a class="toc-href" href="#overview-for-the-unititated" title="Overview For The Unititated">Overview For The Unititated</a></li><li><a class="toc-href" href="#prerequisites" title="Prerequisites">Prerequisites</a></li><li><a -="" boot!)="" class="toc-href" em="" href="#dales-la-bota-give-em-the-boot-installation" installation'="" the="" title="&iexcl;Dales la Bota! (Give ">&iexcl;Dales la Bota! (Give 'em The Boot!) - Installation</a></li><li><a class="toc-href" href="#appendix-alternative-install-methods" title="Appendix: Alternative Install Methods">Appendix: Alternative Install Methods</a></li></ul></div>
    </div>
  <div class="entry-content status-published">
    <p>With the power of <a class="reference external" href="http://boot-clj.com/">boot</a>, it's possible to go from "never used java before" to budding <a class="reference external" href="http://clojure.org/">Clojure</a>-ist cranking out jars like a pickle factory in record time. This post walks you through the process, and provides some post-'hello world' examples, with pointers to more information.</p>

<div class="section" id="overview-for-the-unititated">
<h2 id="overview-for-the-unititated">Overview For The Unititated</h2>
<p>For those who are absolute Clojure beginners, here are a few clarifying terms and concepts.</p>
<p>Clojure is a <em>functional programming language</em> in the style of Common Lisp. "Functional" in this sense means that functions are first-class objects; code and data are peers. Data is <em>immutable</em> - as values change, objects are replaced, not manipulated. Code structures and language features common to most other types of languages are not present. Instead, they are implemented as functions or are simply not necessary.</p>
<p>Functional languages, especially in the Lisp-style are <em>expressive</em> and, linguistically speaking, <em>simple</em>. The original Lisp, invented in 1958 by John McCarthy at M.I.T., was expressed in seven functions and two special forms - the language, in total, contained just <em>nine elements</em>, and was fully Touring-complete. By comparison, the current version (3.5) of Python has 30+ keywords, plus special elements such as mathematical operators and colons - and that's merely the language itself, that doesn't include idioms or conventions.</p>
<p>What this adds up to is a vast reduction in "incidental complexity" - complexities that creep into code because of the limitations, or expectations, of our languages. Contrast incidental complexity with "essential complexity", or complexities that our code would not function without. Lisp-like languages stay out of your way.</p>
<p>In terms of Clojure, we are blessed with a very concise, easy to reason about syntax that gives us incredible flexibility. We are also provided with a robust standard library.</p>
<p>Clojure was designed with concurrency in mind, from its inception. This makes advanced use of threads and multiple processes simple and quite accessible, not to mention <em>safe</em>.</p>
<p>Clojure is a general language specification. It has been implemented for the Java Virtual Machine (JVM), JavaScript, and
the Microsoft .Net Common Languge Runtime (CLR). There are platform-specific nuances, but the core language and library is the same - as you move from a Java environment  to a .Net one or onto front-end browser development, your Clojure skills will convey.</p>
<p>This tutorial focuses on using Clojure with the JVM. This requires the installation of a Java Development Kit (JDK). It's really the only hard prerequisite.</p>
<p>Java applications are typically distributed as JAR files - simple Zipped archives of compiled source code. We will be using Boot to compile and package some example applications.</p>
<div class="section" id="about-boot">
<h3>About Boot</h3>
<p>Boot is a relatively new build tool for Clojure. It succeeds where others have been found wanting. This is because it embodies core Clojure philosophies, in particular the aforementioned reduction in <em>incidental complexity</em>.</p>
<p>If you have read some other Clojure tutorials or books, you will likely have been introduced to Leiningen. Leiningen is the defacto standard Clojure build tool. Its functionality overlaps with Boot's, but the approach is very different.</p>
<p>Leiningen provides some special conventions and a domain-specific language (DSL) to drive the build and development processes. Boot, on the other hand, is purely functional. With the exception of some isolation mechanisms implemented under the hood, Boot works just like any other Clojure library. Extending Boot is as simple as writing any other Clojure code. Leiningen requires that you implement some complex APIs to extend it.</p>
<p>My personal favorite feature of Boot, which I believe makes it not only a superior build tool, but an all-around killer utility even outside the build problem space, is <em>scripting</em>. Clojure is a compiled language, so the concept of Clojure scripts is not baked in. However, Boot, using the same conventions as you would use to manage a build process, gives us the ability to write scripts.</p>
<p>These scripts work just like shell scripts, with a few key exceptions:</p>
<ul class="simple">
<li>They are written entirely in Clojure.</li>
<li>They can have dependencies on Clojure libraries that are resolved at runtime.</li>
</ul>
<p>This means you can distribute Boot scripts in the same manner as Python or Bash scripts - except dependencies are handled automatically.</p>
<p>This concept is explored in the sister post to this one, <a class="reference external" href="/boot-getting-started-with-clojure-in-10-minutes.html">Boot: Getting Started With Clojure In 10 Minutes</a></p>
</div>
<div class="section" id="installation-development-setup">
<h3>Installation/Development Setup</h3>
<p>The command-line examples assume a unix-like environment, and are to be run within a terminal. The bash shell was used. Examples have been tested on Ubuntu Linux and MacOs.</p>
<p>However, the principals should be transferable to any Linux, BSD or similar operating system.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Clojure is supported in the Microsoft Windows operating system. The author hopes to expand this tutorial to cover Windows sometime in the future.</p>
</div>
<p>Clojure doesn't need to be installed, in the typical sense. Clojure is distributed as a JAR file, and so Boot is able to download it and use it as its standard operating procedure.</p>
<p>Behind the scenes, <a class="reference external" href="https://maven.apache.org/">Maven</a> is used to manage JARs. The public maven repositories are utilized for Java dependencies, and <a class="reference external" href="http://clojars.org/">clojars</a> is used for clojure ones.</p>
</div>
<div class="section" id="conventions">
<h3>Conventions</h3>
<p>See <a class="reference external" href="/pages/conventions.html">Site-wide Conventions Explained</a>.</p>
</div>
</div>
<div class="section" id="prerequisites">
<h2 id="prerequisites">Prerequisites</h2>
<p>You will need the following:</p>
<ul class="simple">
<li><em>A JDK installed</em>.</li>
</ul>
<p>Really, that's it. <a class="reference external" href="http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html">Sun's JDK</a> or <a class="reference external" href="http://openjdk.java.net/">OpenJDK</a> will work. Use the newest version.</p>
<p>In addition, you'll need a way to download things. Feel free to use your browser. The examples below use <a class="reference external" href="https://www.gnu.org/software/wget/">wget</a>.</p>
<p>If you're on Linux or Mac OS, you'll also need root access via <a class="reference external" href="http://www.sudo.ws/">sudo</a> - this is not a hard requirement but allows you to install boot for everyone on your machine to use.</p>
<p>There's an expectation that you know basic <a class="reference external" href="http://clojure.org/">Clojure</a>, and examples try not to be too clever. For a good introduction, check out <a class="reference external" href="http://www.braveclojure.com">Clojure For The Brave and True</a>, specifically <a class="reference external" href="http://www.braveclojure.com/do-things/">Do Things: a Clojure Crash Course</a>. If you need help with specific forms used, the <a class="reference external" href="http://clojure.org/documentation">Clojure Community Documentation</a> is extremely helpful, especially the <a class="reference external" href="http://clojure.org/cheatsheet">Clojure Cheat Sheet</a>.</p>
<p>It may be helpful to give the <a class="reference external" href="https://github.com/boot-clj/boot">boot readme</a> and <a class="reference external" href="https://github.com/boot-clj/boot/wiki">wiki documentation</a> a read.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p><strong>For questions about boot or clojure,</strong> <a class="reference external" href="http://clojurians.net/">The Clojurians Slack</a> <strong>is the defacto place to go to converse with clojure rockstars and other newbs alike.</strong></p>
<p class="last"><strong>If slack isn't your jam,</strong> <a class="reference external" href="http://en.wikipedia.org/wiki/Internet_Relay_Chat">IRC</a> <strong>is another great way to get in touch with clojure folks. Come join us on</strong> <a class="reference external" href="https://freenode.net/">freenode</a>, <strong>in #hoplon.</strong></p>
</div>
</div>
<div class="section" id="dales-la-bota-give-em-the-boot-installation">
<h2 id="dales-la-bota-give-em-the-boot-installation"><em>&iexcl;Dales la Bota!</em> (Give 'em The <em>Boot</em>!) - <em>Installation</em></h2>
<p><a class="reference external" href="http://boot-clj.com/">Boot</a> is '<a class="reference external" href="https://github.com/boot-clj/boot#install">installed</a>' by simply downloading an <a class="reference external" href="https://github.com/boot-clj/boot/releases">executable file</a> and putting it somewhere where you can execute it.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For more options, see <a class="reference internal" href="#appendix-alternative-install-methods">Appendix: Alternative Install Methods</a>.</p>
</div>
<p>In our case, we'll use our home directory:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="gp">$</span> wget https://github.com/boot-clj/boot-bin/releases/download/latest/boot.sh
<span class="gp">$</span> mkdir -p ~/bin
<span class="gp">$</span> mv boot.sh boot <span class="o">&amp;&amp;</span> chmod a+x boot <span class="o">&amp;&amp;</span> mv boot ~/bin/
</pre></div>
</td></tr></table><div class="explanation section">
<h3>Explanation</h3>
<div class="docutils container">
</div>
<p>First we need to download the boot executable script. The .sh extension indicates it's a shell script.</p>
<p>Then a directory is created with <code>mkdir</code> for personal executables (binaries, hence <code>bin</code>). We use the <code>-p</code> flag to tell <code>mkdir</code> that any intermediary directories should be created. <code>-p</code> also silences any errors for already-existing directories.</p>
<p>The tilde <code>~</code> is an alias for the current user's home directory. We use it here because the specific path for home is variable depending on both the user, and the operating system. For example, if my log in is jjmojojjmojo, on Linux, my home directory is likely <code>/home/jjmojojjmojo</code>. But on some systems, it will be <code>/var/users/jjmojojjmojo</code>. On MacOS, home directories are in <code>/Users</code>. See <a class="reference external" href="https://en.wikipedia.org/wiki/Home_directory">this wikipedia article</a> for more information.</p>
<p>Finally, we string a few commands together using <code>&amp;&amp;</code>. <code>&amp;&amp;</code> will execute the following command if the preceding one succeeds (has a 0 return value). Here's what each part does:</p>
<ol class="arabic simple">
<li>We rename (move) the <code>boot.sh</code> to <code>boot</code>. This way we can type <code>boot</code> instead of <code>boot.sh</code> to execute boot commands later on.</li>
<li>We change the <em>mode</em> of the <code>boot</code> script to include <em>execute</em> for the group, owner, and other bits. This allows the script to be executed like any other command - and by anyone who can read it. Using this approach (as opposed to, say <code>chmod 755</code>) only modifies the execute bit for each class. <a class="reference external" href="http://mason.gmu.edu/~montecin/UNIXpermiss.htm">More info</a>.</li>
<li>Finally, we move the <code>boot</code> script to our personal <code>~/bin</code> directory, so the shell can find it when we set that up in the next step.</li>
</ol>
</div>
<p>Then we need to update our <code>$PATH</code> environment variable so the shell can find our new executable boot:</p>
<div class="highlight"><pre><span></span><span class="gp">$</span> <span class="nb">echo</span> <span class="s2">"export PATH=\$PATH:\$HOME/bin"</span> &gt;&gt; ~/.bash_profile
<span class="gp">$</span> <span class="nb">export</span> <span class="nv">PATH</span><span class="o">=</span><span class="nv">$PATH</span>:<span class="nv">$HOME</span>/bin
</pre></div>
<div class="explanation section">
<h3>Explanation</h3>
<div class="docutils container">
</div>
<p>The shell looks for executables in a variable called <code>$PATH</code>. <code>$PATH</code> is a list of directories, that are searched in sequential order.</p>
<p>We can get the shell to find our <code>boot</code> script by adding our personal bin directory to the end of that variable. <a class="reference external" href="https://en.wikipedia.org/wiki/PATH_(variable)">More info</a>.</p>
<p>By adding an <code>export</code> command to the end of our <code>~/.bash_profile</code>, we can ensure this modification to our shell happens every time we log in, or start our terminal app. Other environments, and shells have different files that are used this way.</p>
<p>We accomplish this by using the <code>echo</code> command. <code>echo</code> sends data to the terminal output (stdout). We redirect that output to be appended to <code>~/.bash_profile</code>, using two greater-than symbols (<code>&gt;&gt;</code>). <a class="reference external" href="http://www.tldp.org/LDP/abs/html/io-redirection.html">More info</a>.</p>
<p>Note that we escape the dollar signs in the <code>$PATH</code> and <code>$HOME</code> variables. This prevents the shell from expanding the current value for those variables before adding the <code>export</code> to <code>~/.bash_profile</code>.</p>
<p>Finally, we make the change take effect in our current shell by running the export (without the escaped dollar signs).</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Depending on your distribution, and shell, the way to make this change permanent may be different. Most shells read a special file in your home directory. Look for files like <code>~/.bashrc</code>, <code>~/.profile</code>, etc.</p>
</div>
<p>The real magic happens when boot is run. Boot sets everything up in a <tt class="docutils literal">.boot</tt> directory in your home folder. Without having any code to execute yet, you can trigger this by simply asking boot for help:</p>
<div class="highlight"><pre><span></span><span class="gp">$</span> boot -h
<span class="go">Downloading https://github.com/boot-clj/boot/releases/download/2.7.2/boot.jar...</span>
<span class="go">Running for the first time, BOOT_VERSION not set: updating to latest.</span>
<span class="go">Retrieving clojure-1.8.0.pom from https://repo1.maven.org/maven2/ (8k)</span>
<span class="go">Retrieving oss-parent-7.pom from https://repo1.maven.org/maven2/ (5k)</span>
<span class="go">Retrieving maven-metadata.xml from https://repo.clojars.org/</span>
<span class="go">Retrieving boot-2.7.2.pom from https://repo.clojars.org/ (2k)</span>
<span class="go">Retrieving boot-2.7.2.jar from https://repo.clojars.org/ (3k)</span>
<span class="go">Retrieving clojure-1.8.0.jar from https://repo1.maven.org/maven2/ (3538k)</span>
<span class="gp">#</span>http://boot-clj.com
<span class="gp">#</span>Wed May <span class="m">09</span> <span class="m">20</span>:19:27 EDT <span class="m">2018</span>
<span class="go">BOOT_CLOJURE_NAME=org.clojure/clojure</span>
<span class="go">BOOT_VERSION=2.7.2</span>
<span class="go">BOOT_CLOJURE_VERSION=1.8.0</span>
</pre></div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>If you have previously installed boot, it's a good idea to run boot's self-update (<code>boot -u</code>) before continuing:</p>
<div class="last"><div class="highlight"><pre><span></span><span class="gp">$</span> boot -u
<span class="go">Retrieving boot-2.7.0.jar from https://clojars.org/repo/</span>
<span class="gp">#</span>http://boot-clj.com
<span class="gp">#</span>Wed Dec <span class="m">14</span> <span class="m">11</span>:53:20 EST <span class="m">2016</span>
<span class="go">BOOT_CLOJURE_NAME=org.clojure/clojure</span>
<span class="go">BOOT_CLOJURE_VERSION=1.7.0</span>
<span class="go">BOOT_VERSION=2.7.0</span>
</pre></div>
</div></div>
<div class="section" id="let-s-play-with-clojure">
<h3>Let's Play With Clojure</h3>
<div class="section" id="the-repl">
<h4>The REPL</h4>
<p>Clojure utilizes a concept called a <a class="reference external" href="http://en.wikipedia.org/wiki/Read%E2%80%93eval%E2%80%93print_loop">REPL</a> (<strong>R</strong>ead, <strong>E</strong>valuate, <strong>P</strong>rint, <strong>L</strong>oop). REPLs allow you to interactively run code and experiment.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="gp">$</span> boot repl
</pre></div>
</td></tr></table><div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Boot's <tt class="docutils literal">repl</tt> task downloads a bunch of dependencies. Don't be alarmed if a bunch of text scrolls by the first time you run <tt class="docutils literal">boot repl</tt>.</p>
</div>
<p>Boot then provides you with a prompt, where you can play around:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">nREPL</span> <span class="nv">server</span> <span class="nv">started</span> <span class="nv">on</span> <span class="nv">port</span> <span class="mi">62443</span> <span class="nv">on</span> <span class="nv">host</span> <span class="mf">127.0</span><span class="nv">.0.1</span> <span class="nb">- </span><span class="nv">nrepl</span><span class="ss">://127.0.0.1:62443</span>
<span class="nv">REPL-y</span> <span class="mf">0.3</span><span class="nv">.7</span>, <span class="nv">nREPL</span> <span class="mf">0.2</span><span class="nv">.12</span>
<span class="nv">Clojure</span> <span class="mf">1.8</span><span class="nv">.0</span>
<span class="nv">Java</span> <span class="nv">HotSpot</span><span class="p">(</span><span class="nf">TM</span><span class="p">)</span> <span class="mi">64</span><span class="nv">-Bit</span> <span class="nv">Server</span> <span class="nv">VM</span> <span class="mf">1.8</span><span class="nv">.0_92-b14</span>
        <span class="nv">Exit</span><span class="err">:</span> <span class="nv">Control+D</span> <span class="nb">or </span><span class="p">(</span><span class="nf">exit</span><span class="p">)</span> <span class="nb">or </span><span class="p">(</span><span class="nf">quit</span><span class="p">)</span>
    <span class="nv">Commands</span><span class="err">:</span> <span class="p">(</span><span class="nf">user/help</span><span class="p">)</span>
        <span class="nv">Docs</span><span class="err">:</span> <span class="p">(</span><span class="nb">doc </span><span class="nv">function-name-here</span><span class="p">)</span>
              <span class="p">(</span><span class="nb">find-doc </span><span class="s">"part-of-name-here"</span><span class="p">)</span>
<span class="nv">Find</span> <span class="nv">by</span> <span class="nv">Name</span><span class="err">:</span> <span class="p">(</span><span class="nf">find-name</span> <span class="s">"part-of-name-here"</span><span class="p">)</span>
      <span class="nv">Source</span><span class="err">:</span> <span class="p">(</span><span class="nf">source</span> <span class="nv">function-name-here</span><span class="p">)</span>
     <span class="nv">Javadoc</span><span class="err">:</span> <span class="p">(</span><span class="nf">javadoc</span> <span class="nv">java-object-or-class-here</span><span class="p">)</span>
    <span class="nv">Examples</span> <span class="nv">from</span> <span class="nv">clojuredocs.org</span><span class="err">:</span> <span class="p">[</span><span class="nv">clojuredocs</span> <span class="nb">or </span><span class="nv">cdoc</span><span class="p">]</span>
              <span class="p">(</span><span class="nf">user/clojuredocs</span> <span class="nv">name-here</span><span class="p">)</span>
              <span class="p">(</span><span class="nf">user/clojuredocs</span> <span class="s">"ns-here"</span> <span class="s">"name-here"</span><span class="p">)</span>
<span class="nv">boot.user=&gt;</span> <span class="p">(</span><span class="nb">+ </span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span><span class="p">)</span>
<span class="mi">15</span>
<span class="nv">boot.user=&gt;</span> <span class="p">(</span><span class="nb">/ </span><span class="mi">10</span> <span class="mi">0</span><span class="p">)</span>

<span class="nv">java.lang.ArithmeticException</span><span class="err">:</span> <span class="nv">Divide</span> <span class="nv">by</span> <span class="nv">zero</span>
</pre></div>
</td></tr></table><div class="explanation section">
<h5>Explanation</h5>
<div class="docutils container">
</div>
<p>The first few lines provide some basic information:</p>
<ul class="simple">
<li>Line 1: <a class="reference external" href="https://github.com/clojure/tools.nrepl">nREPL</a> is a service that allows you to connect to a repl using a remote client.</li>
<li>Line 2: <a class="reference external" href="https://github.com/trptcolin/reply">REPL-y</a> is an alternative to the built-in REPL that has some nice features.</li>
<li>Line 3: We're using Clojure 1.8.</li>
<li>Line 4: This is the particular JVM in use.</li>
</ul>
<p>Line's 5 through 14 are some helpful forms and functions you can use inside the REPL.</p>
<p>The <code>boot.user=&gt;</code> prompt tells us that we are in a special <a class="reference external" href="https://clojure.org/reference/namespaces">namespace</a>, set up for us by boot.</p>
<p>On line 15, we're doing a simple addition of some integers. When you press enter after typing some code, the result is printed below.</p>
<p>On line 17, we illustrate what happens when there is a java exception. If you'd like to see the full stacktrace, you can use the <a class="reference external" href="https://clojuredocs.org/clojure.repl/pst">pst</a> (<em>print stack trace</em>) form:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">boot.user=&gt;</span> <span class="p">(</span><span class="nb">/ </span><span class="mi">10</span> <span class="mi">0</span><span class="p">)</span>

<span class="nv">java.lang.ArithmeticException</span><span class="err">:</span> <span class="nv">Divide</span> <span class="nv">by</span> <span class="nv">zero</span>

<span class="nv">boot.user=&gt;</span> <span class="p">(</span><span class="nf">pst</span><span class="p">)</span>
 <span class="nv">clojure.core/eval</span>                          <span class="nv">core.clj</span><span class="err">:</span> <span class="mi">3105</span>
         <span class="nv">...</span>
<span class="nv">boot.user/eval1532</span>  <span class="nv">boot.user3203296763858150787.clj</span><span class="err">:</span>    <span class="mi">1</span>
         <span class="nv">...</span>
<span class="nv">java.lang.ArithmeticException</span><span class="err">:</span> <span class="nv">Divide</span> <span class="nv">by</span> <span class="nv">zero</span>
<span class="nv">nil</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="a-simple-clojure-function">
<h4>A Simple Clojure Function</h4>
<p>Here's a simple Clojure function that prints the <a class="reference external" href="http://www.mathsisfun.com/numbers/fibonacci-sequence.html">Fibonacci sequence</a> to a given number of digits:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="p">(</span><span class="kd">defn </span><span class="nv">fib</span>
&nbsp; <span class="p">([</span><span class="nv">n</span><span class="p">]</span>
&nbsp;&nbsp;&nbsp; <span class="p">(</span><span class="nf">fib</span> <span class="p">[</span><span class="mi">0</span> <span class="mi">1</span><span class="p">]</span> <span class="nv">n</span><span class="p">))</span>
&nbsp; <span class="p">([</span><span class="nv">pair</span>, <span class="nv">n</span><span class="p">]</span>
&nbsp;&nbsp;&nbsp; <span class="p">(</span><span class="nb">print </span><span class="p">(</span><span class="nb">first </span><span class="nv">pair</span><span class="p">)</span> <span class="s">" "</span><span class="p">)</span>
&nbsp;&nbsp;&nbsp; <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">&gt; </span><span class="nv">n</span> <span class="mi">1</span><span class="p">)</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="p">(</span><span class="nf">fib</span> <span class="p">[(</span><span class="nb">second </span><span class="nv">pair</span><span class="p">)</span> <span class="p">(</span><span class="nb">apply + </span><span class="nv">pair</span><span class="p">)]</span> <span class="p">(</span><span class="nb">- </span><span class="nv">n</span> <span class="mi">1</span><span class="p">))</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="p">(</span><span class="nf">println</span><span class="p">))))</span>
</pre></div>
</td></tr></table><div class="explanation section">
<h5>Explanation</h5>
<div class="docutils container">
</div>
<p>This is a basic clojure function definition. It uses <a class="reference external" href="http://clojure-doc.org/articles/language/functions.html#multi-arity-functions">multiple airties</a>. This is how you provide multiple different ways to call the same function.</p>
<p>Note how on line 2 and line 4 we specify two different argument lists. The first is for calling the function the typical way (providing the maximum number of levels), the second is used for recursion - the <tt class="docutils literal">pair</tt> argument is a sequence containing the previous and current number in the sequence.</p>
<ul class="simple">
<li>Line 1: The opening of the function definition.</li>
<li>Line 2: The first airty - one single argument named <tt class="docutils literal">n</tt>. The maximum number of levels.</li>
<li>Line 3: Recursion - if only one argument is passed, call <tt class="docutils literal">fib</tt> again, but with 0 and 1 (the first numbers in the Fibonacci sequence) to get things started.</li>
<li>Line 4: The second airty - two argunments: <tt class="docutils literal">pair</tt> a sequence containin two integers representing the previous and current numbers in the sequence, and <tt class="docutils literal">n</tt>, the maximum number of levels.</li>
<li>Line 5: print the previous number to <a class="reference external" href="https://en.wikipedia.org/wiki/Standard_streams#Standard_output_(stdout)">standard out</a>. We're using the <a class="reference external" href="https://clojuredocs.org/clojure.core/print">print</a> function here to avoid adding a line break after the number so they'll all print to the console on the same line.</li>
<li>Line 6: the <a class="reference external" href="https://clojuredocs.org/clojure.core/if">if</a> form  is used to check if we've hit the maximum number of levels yet. We subtract one from <tt class="docutils literal">n</tt> every iteration, so when it's equal to 1, it's time to stop.</li>
<li>Line 7: <em>True condition.</em> Recurse, this time passing a vector containing the current number, and the sum of the current and previous number. The second parameter is the maximum level minus one.</li>
<li>Line 8: <em>False condition.</em> The end of the requested sequence. Use the <a class="reference external" href="https://clojuredocs.org/clojure.core/println">println</a> function with no arguments to print a final line break.</li>
</ul>
</div>
<p>You can paste this into your REPL and try it out:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">boot.user=&gt;</span> <span class="p">(</span><span class="kd">defn </span><span class="nv">fib</span>
   <span class="o">#</span><span class="nv">_=&gt;</span>   <span class="p">([</span><span class="nv">n</span><span class="p">]</span>
   <span class="o">#</span><span class="nv">_=&gt;</span>     <span class="p">(</span><span class="nf">fib</span> <span class="p">[</span><span class="mi">0</span> <span class="mi">1</span><span class="p">]</span> <span class="nv">n</span><span class="p">))</span>
   <span class="o">#</span><span class="nv">_=&gt;</span>   <span class="p">([</span><span class="nv">pair</span>, <span class="nv">n</span><span class="p">]</span>
   <span class="o">#</span><span class="nv">_=&gt;</span>     <span class="p">(</span><span class="nb">print </span><span class="p">(</span><span class="nb">first </span><span class="nv">pair</span><span class="p">)</span> <span class="s">" "</span><span class="p">)</span>
   <span class="o">#</span><span class="nv">_=&gt;</span>     <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">&gt; </span><span class="nv">n</span> <span class="mi">1</span><span class="p">)</span>
   <span class="o">#</span><span class="nv">_=&gt;</span>       <span class="p">(</span><span class="nf">fib</span> <span class="p">[(</span><span class="nb">second </span><span class="nv">pair</span><span class="p">)</span> <span class="p">(</span><span class="nb">apply + </span><span class="nv">pair</span><span class="p">)]</span> <span class="p">(</span><span class="nb">- </span><span class="nv">n</span> <span class="mi">1</span><span class="p">))</span>
   <span class="o">#</span><span class="nv">_=&gt;</span>       <span class="p">(</span><span class="nf">println</span><span class="p">))))</span>
<span class="o">#</span><span class="ss">'boot.user/fib</span>
<span class="nv">boot.user=&gt;</span> <span class="p">(</span><span class="nf">fib</span> <span class="mi">10</span><span class="p">)</span>
<span class="mi">0</span> <span class="mi">1</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">5</span> <span class="mi">8</span> <span class="mi">13</span> <span class="mi">21</span> <span class="mi">34</span> <span class="mi">55</span>
<span class="nv">nil</span>
<span class="nv">boot.user=&gt;</span> <span class="nv">exit</span>
<span class="nv">Bye</span> <span class="nb">for </span><span class="nv">now!</span>
</pre></div>
</td></tr></table><div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">You can copy the prompts along with the code, the REPL will ignore them.</p>
</div>
</div>
<div class="section" id="boot-scripts">
<h4>Boot Scripts</h4>
<p>Boot also works as a <a class="reference external" href="https://github.com/boot-clj/boot/wiki/Scripts">scripting platform</a> - you can construct applications, specifying dependencies, and parse command-line arguments.</p>
<p>We can transform that function into a command-line tool using the power of boot scripting. Assume this file is called <code>fib.boot</code>:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="o">#</span><span class="nv">!/usr/bin/env</span> <span class="nv">boot</span>

<span class="p">(</span><span class="kd">defn </span><span class="nv">fib</span>
 &nbsp; <span class="p">([</span><span class="nv">n</span><span class="p">]</span>
 &nbsp;&nbsp;&nbsp; <span class="p">(</span><span class="nf">fib</span> <span class="p">[</span><span class="mi">0</span> <span class="mi">1</span><span class="p">]</span> <span class="nv">n</span><span class="p">))</span>
 &nbsp; <span class="p">([</span><span class="nv">pair</span>, <span class="nv">n</span><span class="p">]</span>
 &nbsp;&nbsp;&nbsp; <span class="p">(</span><span class="nb">print </span><span class="p">(</span><span class="nb">str </span><span class="p">(</span><span class="nb">first </span><span class="nv">pair</span><span class="p">)</span> <span class="s">" "</span><span class="p">))</span>
 &nbsp;&nbsp;&nbsp; <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">&gt; </span><span class="nv">n</span> <span class="mi">1</span><span class="p">)</span>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="p">(</span><span class="nf">fib</span> <span class="p">[(</span><span class="nb">second </span><span class="nv">pair</span><span class="p">)</span> <span class="p">(</span><span class="nb">apply + </span><span class="nv">pair</span><span class="p">)]</span> <span class="p">(</span><span class="nb">- </span><span class="nv">n</span> <span class="mi">1</span><span class="p">))</span>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="p">(</span><span class="nf">println</span><span class="p">))))</span>

<span class="p">(</span><span class="kd">defn </span><span class="nv">-main</span> <span class="p">[</span><span class="o">&amp;</span> <span class="nv">args</span><span class="p">]</span>
 &nbsp; <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">limit</span> <span class="p">(</span><span class="nb">first </span><span class="nv">args</span><span class="p">)]</span>
 &nbsp;&nbsp;&nbsp; <span class="p">(</span><span class="nb">println </span><span class="s">"Printing fibonacci sequence up to "</span> <span class="nv">limit</span> <span class="s">"numbers"</span><span class="p">)</span>
 &nbsp;&nbsp;&nbsp; <span class="p">(</span><span class="nf">fib</span> <span class="p">(</span><span class="nf">Integer/parseInt</span> <span class="nv">limit</span><span class="p">))))</span>
</pre></div>
</td></tr></table><div class="explanation section">
<h5>Explanation</h5>
<div class="docutils container">
</div>
<p>The primary differences betweent a boot script and the bare boot function we wrote earlier:</p>
<ul class="simple">
<li>A boot script is a shell script, and so it needs a line to indicate which interpreter is required to parse the contents. This is known as a <a class="reference external" href="https://en.wikipedia.org/wiki/Shebang_(Unix)">shebang</a> or 'hashbang' line. (Line 1.)</li>
<li>A boot script requires a <tt class="docutils literal"><span class="pre">-main</span></tt> function to be defined. This function is invoked by boot when the script is run. (Line 12.)</li>
</ul>
<p>The shebang line has to be a 'full' path (not relative) to the executable.</p>
<p>In our shebang line, on line 1, we're using a (mostly) ubiquitous tool called <tt class="docutils literal">env</tt>, that looks for the given argument (<tt class="docutils literal">boot</tt>) in the directories specified in the <tt class="docutils literal">$PATH</tt> environment variable of the current user. This way, we don't have to hard code the location of the boot tool, since it can vary.</p>
<p>For example,  in this article we've installed boot in <tt class="docutils literal">~/bin</tt>. In my case that expands to <tt class="docutils literal">/Users/jj/bin</tt>, but in yours, it might be <tt class="docutils literal">/home/joecool/bin</tt> or <tt class="docutils literal">/var/home/bethrulz</tt>. The location for home directories varies by operating system and more often than not, we will have different user names.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <tt class="docutils literal">~</tt> shortcut for <tt class="docutils literal">$HOME</tt> is not expanded in shebang lines.</p>
</div>
<p>Or, you may have installed boot globally into <tt class="docutils literal">/usr/local/bin</tt> or any number of other possible system locations depending on a lot of factors. Using <tt class="docutils literal">env</tt> is a handy way to remove that complexity.</p>
<p>Lines 3-10 are the same Fibonacci sequence we used before.</p>
<p>Line 12 provides an <em>entry point</em>, a function that boot will invoke when the script is run. The name <tt class="docutils literal"><span class="pre">-main</span></tt> is required by boot. The argument list uses the <tt class="docutils literal">&amp;</tt> special form to collect a variable number of arguments into a single sequence named <tt class="docutils literal">args</tt> (a function that does this is called a <a class="reference external" href="http://clojure-doc.org/articles/language/functions.html#variadic-functions">variadic function</a>).</p>
<p>Boot passes the function a variable number of strings . Each string is text that was provided by the user in the console while invoking the script (typically referred to 'command-line arguments' or 'command-line options').</p>
<p>For example, if an imaginary command-line tool called <tt class="docutils literal">boo</tt> is executed with "hello world, welcome to the thunder dome", like this:</p>
<div class="highlight"><pre><span></span><span class="gp">$</span> boo hello world, welcome to the thunder dome
</pre></div>
<p>The content of <tt class="docutils literal">args</tt> will be</p>
<div class="highlight"><pre><span></span><span class="p">[</span><span class="s">"hello"</span> <span class="s">"world,"</span> <span class="s">"welcome"</span> <span class="s">"to"</span> <span class="s">"the"</span> <span class="s">"thunder"</span> <span class="s">"dome"</span><span class="p">]</span>
</pre></div>
<p>This is something the shell does. It can be avoided by surrounding the arguments with double quotes, like this:</p>
<div class="highlight"><pre><span></span><span class="gp">$</span> boo <span class="s2">"hello world, welcome"</span> <span class="s2">"to the thunder dome"</span>
</pre></div>
<p>In this case, <tt class="docutils literal">args</tt> is a vector containing two elements:</p>
<div class="highlight"><pre><span></span><span class="p">[</span><span class="s">"hello world, welcome"</span> <span class="s">"to the thunder dome"</span><span class="p">]</span>
</pre></div>
<p>It's important to note that the shell can do other things with arguments that may be unexpected. The ins and outs of shells are outside the scope of this tutorial (and can vary from shell to shell), but here are a couple of common ones that might be useful or trip you up:</p>
<ul class="simple">
<li><strong>Glob Expansion.</strong> Shells help you out by replacing special patterns with matching filenames, so you can pass a bunch of paths to a command line tool without having to type them all out. <a class="reference external" href="https://en.wikipedia.org/wiki/Glob_(programming)">More info</a>.</li>
<li><strong>Environment Variable Expansion.</strong> Shells understand inline variables and will expand them before running your command line tool. Common useful environment variables include <tt class="docutils literal">$HOME</tt>, <tt class="docutils literal">$PATH</tt>, <tt class="docutils literal">$SHELL</tt>, and <tt class="docutils literal">$PWD</tt>.</li>
<li><strong>Subshell Execution.</strong> Shells can execute commands for you and pass the results on to your command line script.</li>
</ul>
<p>Because of these things, it's good to be conscious of which characters are used to make use of these special features, and how to escape them so you don't get unexpected arguments passed to your scripts. This will vary depending on your shell - <a class="reference external" href="https://www.safaribooksonline.com/library/view/learning-the-bash/1565923472/ch01s09.html">take a look at a chapter from a book on learning bash</a> to get an idea of what you need to look out for.</p>
<p>On line 13, we extract the first member of <tt class="docutils literal">args</tt> to pass as the maximum number of Fibonacci iterations.</p>
<p>Line 14 prints some informatio to the user to let them know what's going on.</p>
<p>On line 15, the <tt class="docutils literal">fib</tt> is finally executed, passing the limit provided by the user on the command line.</p>
<p>We need to convert the limit to an integer for use by our <tt class="docutils literal">fib</tt> function. This is accomplished using the Java <tt class="docutils literal">Integer.ParseInt()</tt> function.</p>
<p>It may seem odd that we invoke a Java function here, but this is common practice in Clojure, since we are usually running on the JVM. It's referred to as <a class="reference external" href="https://clojure.org/reference/java_interop">Java interop</a>.</p>
</div>
<p>Next, we make the script executable:</p>
<div class="highlight"><pre><span></span><span class="gp">$</span> chmod u+x fib.boot
</pre></div>
<div class="explanation section">
<h5>Explanation</h5>
<div class="docutils container">
</div>
<p>We're again utilizing the <tt class="docutils literal">chmod</tt> command to make a file executable. Here, we use the shorthand mode specification (see the man page <a class="reference external" href="https://linux.die.net/man/1/chmod">online</a> or you can type <tt class="docutils literal">man chmod</tt> in your console for specifics), instead of using octal numbers (like <tt class="docutils literal">755</tt>).</p>
<p><tt class="docutils literal">u+x</tt> means "<em>add</em> whatever bits are necessary to allow the <strong>u</strong>ser to e<strong>x</strong>ecute this file". This leaves any other bits untouched.</p>
</div>
<p>Now you can run the script:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="gp">$</span> ./fib.boot <span class="m">10</span>
<span class="go">Printing fibonacci sequence up to 10 numbers</span>
<span class="go">0 1 1 2 3 5 8 13 21 34</span>
</pre></div>
</td></tr></table></div>
<div class="section" id="dependencies">
<h4>Dependencies</h4>
<p>The script can declare dependencies, which will be downloaded as needed when the script is run. Here, we'll show the use of an external dependency: we can write a new Fibonacci sequence that exploits an the fact that numbers in the sequence are related to each other by approximately the <a class="reference external" href="http://en.wikipedia.org/wiki/Golden_ratio">golden ratio</a> (ca 1.62), as noted by Kepler, and derived from <a class="reference external" href="https://en.wikipedia.org/wiki/Fibonacci_number#Binet's_formula">Binets Formula</a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>I'm not a maths scholar, so I may have the specifics and credit a bit wrong. The <a class="reference external" href="https://en.wikipedia.org/wiki/Fibonacci_number#Relation_to_the_golden_ratio">Wikipedia page</a> is a bit thin on specific references for the use of the golden ratio and rounding to calculate one Fibonacci number using another.</p>
<p class="last">If you happen upon this and can shed some light on the subject, please <a class="reference external" href="/pages/contact.html">drop me a line</a>!</p>
</div>
<p>Rounding makes it all work, but rounding isn't "baked in" to Clojure, so we'll use an external library to do it for us, called <a class="reference external" href="https://github.com/clojure/math.numeric-tower">math.numeric-tower</a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In actuality, the required functionality is present, you just need to use some <a class="reference external" href="http://stackoverflow.com/a/25098576">existing Java libraries</a> to make it work. I admit this is a bit of a strain, but it illustrates the use of external dependencies in boot.</p>
</div>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="o">#</span><span class="nv">!/usr/bin/env</span> <span class="nv">boot</span>

<span class="p">(</span><span class="nf">set-env!</span> <span class="ss">:dependencies</span> <span class="o">'</span><span class="p">[[</span><span class="nv">org.clojure/math.numeric-tower</span> <span class="s">"0.0.4"</span><span class="p">]])</span>

<span class="p">(</span><span class="nf">require</span> <span class="o">'</span><span class="p">[</span><span class="nv">clojure.math.numeric-tower</span> <span class="ss">:refer</span> <span class="p">[</span><span class="nv">round</span> <span class="nv">sqrt</span> <span class="nv">expt</span><span class="p">]])</span>

<span class="p">(</span><span class="k">def </span><span class="nv">phi</span> <span class="p">(</span><span class="nb">/ </span><span class="p">(</span><span class="nb">+ </span><span class="p">(</span><span class="nf">sqrt</span> <span class="mi">5</span><span class="p">)</span> <span class="mi">1</span><span class="p">)</span> <span class="mi">2</span><span class="p">))</span>

<span class="p">(</span><span class="kd">defn </span><span class="nv">fibgolden</span>
   <span class="p">[</span><span class="nv">n</span><span class="p">]</span>
   <span class="p">(</span><span class="k">loop </span><span class="p">[</span><span class="nv">counter</span> <span class="mi">0</span><span class="p">]</span>
     <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">= </span><span class="nv">counter</span> <span class="mi">0</span><span class="p">)</span>
       <span class="p">(</span><span class="nf">do</span>
         <span class="p">(</span><span class="nb">print </span><span class="p">(</span><span class="nb">str </span><span class="mi">0</span> <span class="s">" "</span> <span class="mi">1</span> <span class="s">" "</span> <span class="mi">1</span> <span class="s">" "</span><span class="p">))</span>
         <span class="p">(</span><span class="nf">recur</span> <span class="mi">3</span><span class="p">))</span>
     <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">f</span> <span class="p">(</span><span class="nf">round</span> <span class="p">(</span><span class="nb">/ </span><span class="p">(</span><span class="nf">expt</span> <span class="nv">phi</span> <span class="nv">counter</span><span class="p">)</span> <span class="p">(</span><span class="nf">sqrt</span> <span class="mi">5</span><span class="p">)))]</span>
       <span class="p">(</span><span class="nb">print </span><span class="p">(</span><span class="nb">str </span><span class="nv">f</span> <span class="s">" "</span><span class="p">))</span>
       <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">&lt; </span><span class="nv">counter</span> <span class="p">(</span><span class="nb">- </span><span class="nv">n</span> <span class="mi">1</span><span class="p">))</span>
         <span class="p">(</span><span class="nf">recur</span> <span class="p">(</span><span class="nb">+ </span><span class="nv">counter</span> <span class="mi">1</span><span class="p">)))))))</span>

<span class="p">(</span><span class="kd">defn </span><span class="nv">-main</span> <span class="p">[</span><span class="o">&amp;</span> <span class="nv">args</span><span class="p">]</span>
   <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">cli-arg</span> <span class="p">(</span><span class="nb">first </span><span class="nv">args</span><span class="p">)</span>
         <span class="nv">limit</span> <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">empty?</span> <span class="nv">cli-arg</span><span class="p">)</span> <span class="mi">10</span> <span class="p">(</span><span class="nf">Integer/parseInt</span> <span class="nv">cli-arg</span><span class="p">))]</span>
     <span class="p">(</span><span class="nb">println </span><span class="s">"Printing Fibonacci sequence up to"</span> <span class="nv">limit</span> <span class="s">"numbers"</span><span class="p">)</span>
     <span class="p">(</span><span class="nf">fib</span> <span class="nv">limit</span><span class="p">)</span>
     <span class="p">(</span><span class="nf">println</span><span class="p">)))</span>
</pre></div>
</td></tr></table><div class="explanation section">
<h5>Explanation</h5>
<div class="docutils container">
</div>
<p>Line 3 illustrates how to add a dependency to a boot script.</p>
<p>Boot has the concept of an <a class="reference external" href="https://github.com/boot-clj/boot/wiki/Boot-Environment">environment</a>. The environment represents the current working environment of the JVM during the execution of boot scripts or tasks.</p>
<p>On Line 3 we manipulate the environment using the <tt class="docutils literal"><span class="pre">set-env!</span></tt> function.</p>
<p>Note that this function ends with an exclamation point (!), or <em>bang</em>. Data structures in Clojure are not normally <em>mutable</em> (they can't be changed, only transformed into new ones). But in some cases it's required. So clojurists have established a convention to suffix a function name with an exclamation point to indicate that the function mutates data, or otherwise has side effects.</p>
<p>The environment is represented as a mapping, and so we use symbols to access and change its members. The <tt class="docutils literal">:dependencies</tt> key tells boot which libraries to look for.</p>
<p>Dependencies are first sourced from <a class="reference external" href="https://clojars.org/">clojars</a>, then the <a class="reference external" href="https://maven.apache.org/repository/">Maven central repository</a>.</p>
<p>The format for specifying dependencies is the same that <a class="reference external" href="https://leiningen.org/">Leiningen</a> uses - a vector containing a package specifier (often containing an organizational part, like <tt class="docutils literal">org.clojure</tt> in our script), and a version. Clojars uses <a class="reference external" href="https://semver.org/">semantic versioning</a>, so there are 3 numbers: a major revision (breaks existing APIs), a feature revision (API stays the same), and patch revision (for non-breaking bug fixes).</p>
<p>Note that the list of dependencies is behind a <a class="reference external" href="https://clojure.org/guides/weird_characters#__code_code_var_quote">var quote</a>.</p>
<p>On line 5, the library is brought into our namespace using <a class="reference external" href="https://clojuredocs.org/clojure.core/require">require</a>. (For more information about namespaces and libraries, <em>Clojure For The Brave and True</em>'s <a class="reference external" href="https://www.braveclojure.com/organization/">organization</a> chapter goes into some great detail. We've used the <tt class="docutils literal">:refer</tt> parameter to just import one function, <tt class="docutils literal">round</tt>.</p>
<p>On line 7, we pre-calculate the golden ratio and define a variable named <tt class="docutils literal">phi</tt> (the greek letter phi [&phi;] is used to represent the golden ratio in equations).</p>
<p>Lines 9-19 define our new, golden ratio-based Fibonacci sequence function. It performs basically the same way, except that it's single-airity.</p>
<p>Some interesting concepts introduced in this new function:</p>
<ul class="simple">
<li>This is not a recursive function in the usual sense. Instead, we use the <tt class="docutils literal">loop</tt> function and <tt class="docutils literal">recur</tt> macro. This is the way looping (like you'd use <tt class="docutils literal">for</tt> or <tt class="docutils literal">while</tt> in other languages) works in Clojure. For more details on how they work, check out <a class="reference external" href="https://clojurebridge.github.io/community-docs/docs/clojure/recur/">this ClojureBridge article</a>.</li>
<li>On line 11, we use <tt class="docutils literal">do</tt> to group multiple expressions (printing and recursing) into a single branch of an <tt class="docutils literal">if</tt>. This comes in handy a lot, but be careful not to overuse it - if you are doing too much in a conditional branch, it may be better to factor that code out into its own function.</li>
<li>On line 14 and 17, we use <tt class="docutils literal">str</tt> to concatenate our Fibonacci numbers and some spaces. Core Clojure doesn't have string "math" or interpolation features.</li>
</ul>
<p>On lines 22 and 23, we process the command line argument. Variables that are unpacked by <tt class="docutils literal">let</tt> are processed in order, so we can refer to them right away. We take advantage of this to first extract the argument on line 22, then provide a sane default (10) in the event that the user didn't provide a value. We also go ahead and convert the argument to an integer using Java interop as we did in the previous version.</p>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p>We've added a sane default for the single command-line argument, but otherwise aren't doing any input validation. We'll address this in a shallow way in the next section, when we use Boot's <a class="reference external" href="https://github.com/boot-clj/boot/wiki/Task-Options-DSL">argument DSL</a>, but it's always something to keep in mind.</p>
<p>As such, the current script doesn't handle:</p>
<blockquote class="last">
<ul class="simple">
<li>Negative numbers (it stops after the initial iteration)</li>
<li>Large numbers - Java's <tt class="docutils literal">Integer</tt> has a maximum size (the exact size varies by platform). After fairly few iterations it will hit this number and stop getting larger (it used to throw a stack trace for me, so YMMV). On the computer I'm using at the time of writing, I get repeating values if I pass anything larger than 94 to <tt class="docutils literal">fib.boot</tt>.</li>
<li>Non-integers. If you pass a float (say, 2.45), or anything that <tt class="docutils literal">Integer/parseInt</tt> can't work with, it will throw an exception.</li>
</ul>
</blockquote>
</div>
<p>When you run this code the first time, you'll notice boot tells you that it has downloaded some new jars:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="gp">$</span> ./fib.boot <span class="m">10</span>
<span class="go">Retrieving clojure-1.4.0.jar from http://clojars.org/repo/</span>
<span class="go">Retrieving math.numeric-tower-0.0.4.jar from http://repo1.maven.org/maven2/</span>
<span class="go">Printing fibonacci sequence up to 10 numbers</span>
<span class="go">0 1 1 2 3 5 8 13 21 34</span>
</pre></div>
</td></tr></table><p>The syntax to parse our command line options can be a bit tedious and we will often run into the same patterns over and over, like "flags" (true/false toggles like <tt class="docutils literal"><span class="pre">-n</span></tt> or <tt class="docutils literal"><span class="pre">--without-module-x</span></tt>), collected values (like passing <tt class="docutils literal"><span class="pre">-vvv</span></tt> to increase verbosity), even complex subcommands (like <tt class="docutils literal">git merge</tt>).</p>
<p>Luckily, we can borrow a macro from boot.core that lets us specify CLI options using a robust syntax. For the full syntax, check out <a class="reference external" href="https://github.com/boot-clj/boot/wiki/Task-Options-DSL">the documentation</a>.</p>
<p>Here, we'll let the user choose which implementation they'd like to use, and utilize the task <a class="reference external" href="http://martinfowler.com/books/dsl.html">DSL</a> to do some simple command line options:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="o">#</span><span class="nv">!/usr/bin/env</span> <span class="nv">boot</span>

<span class="p">(</span><span class="nf">set-env!</span> <span class="ss">:dependencies</span> <span class="o">'</span><span class="p">[[</span><span class="nv">org.clojure/math.numeric-tower</span> <span class="s">"0.0.4"</span><span class="p">]])</span>

<span class="p">(</span><span class="nf">require</span> <span class="o">'</span><span class="p">[</span><span class="nv">clojure.math.numeric-tower</span> <span class="ss">:refer</span> <span class="p">[</span><span class="nv">expt</span> <span class="nv">round</span> <span class="nv">sqrt</span><span class="p">]])</span>
<span class="p">(</span><span class="nf">require</span> <span class="o">'</span><span class="p">[</span><span class="nv">boot.cli</span> <span class="ss">:as</span> <span class="nv">cli</span><span class="p">])</span>

<span class="p">(</span><span class="k">def </span><span class="nv">phi</span> <span class="p">(</span><span class="nb">/ </span><span class="p">(</span><span class="nb">+ </span><span class="p">(</span><span class="nf">sqrt</span> <span class="mi">5</span><span class="p">)</span> <span class="mi">1</span><span class="p">)</span> <span class="mi">2</span><span class="p">))</span>

<span class="p">(</span><span class="kd">defn </span><span class="nv">fib</span>
   <span class="p">([</span><span class="nv">n</span><span class="p">]</span>
     <span class="p">(</span><span class="nf">fib</span> <span class="p">[</span><span class="mi">0</span> <span class="mi">1</span><span class="p">]</span> <span class="nv">n</span><span class="p">))</span>
   <span class="p">([</span><span class="nv">pair</span>, <span class="nv">n</span><span class="p">]</span>
      <span class="p">(</span><span class="nb">print </span><span class="p">(</span><span class="nb">str </span><span class="p">(</span><span class="nb">first </span><span class="nv">pair</span><span class="p">)</span> <span class="s">" "</span><span class="p">))</span>
      <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">&gt; </span><span class="nv">n</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">(</span><span class="nf">fib</span> <span class="p">[(</span><span class="nb">second </span><span class="nv">pair</span><span class="p">)</span> <span class="p">(</span><span class="nb">apply + </span><span class="nv">pair</span><span class="p">)]</span> <span class="p">(</span><span class="nb">- </span><span class="nv">n</span> <span class="mi">1</span><span class="p">)))))</span>

<span class="p">(</span><span class="kd">defn </span><span class="nv">fibgolden</span>
   <span class="p">[</span><span class="nv">n</span><span class="p">]</span>
   <span class="p">(</span><span class="k">loop </span><span class="p">[</span><span class="nv">counter</span> <span class="mi">0</span><span class="p">]</span>
     <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">= </span><span class="nv">counter</span> <span class="mi">0</span><span class="p">)</span>
       <span class="p">(</span><span class="nf">do</span>
         <span class="p">(</span><span class="nb">print </span><span class="p">(</span><span class="nb">str </span><span class="mi">0</span> <span class="s">" "</span> <span class="mi">1</span> <span class="s">" "</span> <span class="mi">1</span> <span class="s">" "</span><span class="p">))</span>
         <span class="p">(</span><span class="nf">recur</span> <span class="mi">3</span><span class="p">))</span>
     <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">f</span> <span class="p">(</span><span class="nf">round</span> <span class="p">(</span><span class="nb">/ </span><span class="p">(</span><span class="nf">expt</span> <span class="nv">phi</span> <span class="nv">counter</span><span class="p">)</span> <span class="p">(</span><span class="nf">sqrt</span> <span class="mi">5</span><span class="p">)))]</span>
       <span class="p">(</span><span class="nb">print </span><span class="p">(</span><span class="nb">str </span><span class="nv">f</span> <span class="s">" "</span><span class="p">))</span>
       <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">&lt; </span><span class="nv">counter</span> <span class="p">(</span><span class="nb">- </span><span class="nv">n</span> <span class="mi">1</span><span class="p">))</span>
         <span class="p">(</span><span class="nf">recur</span> <span class="p">(</span><span class="nb">+ </span><span class="nv">counter</span> <span class="mi">1</span><span class="p">)))))))</span>

<span class="p">(</span><span class="nf">cli/defclifn</span> <span class="nv">-main</span>
   <span class="s">"Print a Fibonacci sequence to stdout using one of two algorithms."</span>
   <span class="p">[</span><span class="nv">g</span> <span class="nv">golden</span> <span class="nv">bool</span> <span class="s">"Use the golden mean to calculate"</span>
    <span class="nv">n</span> <span class="nv">number</span> <span class="nv">NUMBER</span> <span class="nb">int </span><span class="s">"Quantity of numbers to generate. Defaults to 10"</span><span class="p">]</span>
   <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">n</span> <span class="p">(</span><span class="ss">:number</span> <span class="nv">*opts*</span> <span class="mi">10</span><span class="p">)</span>
         <span class="nv">note</span> <span class="p">(</span><span class="k">if </span><span class="nv">golden</span> <span class="s">"[golden]"</span> <span class="s">"[recursive]"</span><span class="p">)]</span>
     <span class="p">(</span><span class="nb">println </span><span class="nv">note</span> <span class="s">"Printing Fibonacci sequence up to"</span> <span class="nv">n</span> <span class="s">"numbers:"</span><span class="p">)</span>
     <span class="p">(</span><span class="k">if </span><span class="nv">golden</span>
       <span class="p">(</span><span class="nf">fibgolden</span> <span class="nv">n</span><span class="p">)</span>
       <span class="p">(</span><span class="nf">fib</span> <span class="nv">n</span><span class="p">)))</span>
     <span class="p">(</span><span class="nf">println</span><span class="p">))</span>
</pre></div>
</td></tr></table><div class="explanation section">
<h5>Explanation</h5>
<div class="docutils container">
</div>
<p>This version of the script splices together what we've done in previous examples. We have the recursive <tt class="docutils literal">fib</tt> function on lines 10-16, and the golden ratio-based function on lines 18-28. We've renamed the golden ration-based function to <tt class="docutils literal">fibgolden</tt>.</p>
<p>On line 6, we require the boot command line utility <tt class="docutils literal">boot.cli</tt>. We pass the <tt class="docutils literal">:as</tt> parameter to <tt class="docutils literal">require</tt> in order to give the library a different name in our namespace. We do this just to keep things a bit more tidy (and illustrate this feature!).</p>
<p>The <tt class="docutils literal"><span class="pre">-main</span></tt> function on line 30 is chiefly the same, except that we use the <tt class="docutils literal">defclifn</tt> macro from <tt class="docutils literal">boot.cli</tt> instead of the special <tt class="docutils literal">defn</tt> form.</p>
<p>The string on line 31 will be used in the usage description when the user provides the <tt class="docutils literal"><span class="pre">-h</span></tt> command line argument.</p>
<p>The major difference besides using the macro, is in the argument specification on lines 32 and 33. This is the "option DSL" that is discussed in <a class="reference external" href="https://github.com/boot-clj/boot/wiki/Task-Options-DSL">the documentation</a>.</p>
<p>The command line arguments are extracted and used to populate a special <tt class="docutils literal">*opts*</tt> map that will be automatically in scope of your function.</p>
<p>Line 32 defines a <em>boolean</em> command line argument, or a <em>flag</em>. If the argument is provided, the value will be <tt class="docutils literal">true</tt>, otherwise, it will be <tt class="docutils literal">false</tt>. We are using this argument to let the user change algorithms used to generate their requested Fibonacci sequence.</p>
<p>The first value is the "short form" of the option, <tt class="docutils literal"><span class="pre">-g</span></tt>. The second is the "long form" <tt class="docutils literal"><span class="pre">--golden</span></tt> and also the name of the argument in the <tt class="docutils literal">*opts*</tt> map (without the dashes). Next we specify the type of the argument, <tt class="docutils literal">bool</tt>, short for <em>boolean</em>, or a true/false value. The <tt class="docutils literal">defclifn</tt> macro will convert the string value from the command line arguments into a boolean. Finally, we provide a string that will be used to tell the user what sort of value we're expecting in the usage output.</p>
<p>On the next line, we define another command-line option, this time one that takes a value. This is how the user will tell us how many numbers to generate.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Due to how boot uses the CLI macro, it does not support <em>positional</em> arguments, like we used in our earlier scripts.</p>
<p class="last">However another tool, like <a class="reference external" href="https://github.com/clojure/tools.cli">tools.cli</a> serves a similar purpose and has positional argument support, but is not as nice of an interface.</p>
</div>
<p>In this case, we use <tt class="docutils literal"><span class="pre">-n</span></tt> as the short form, <tt class="docutils literal"><span class="pre">--number</span></tt> as the name/long form, and <tt class="docutils literal">int</tt> as the type. The next form is used as the placeholder when printing the usage information.</p>
<p>The last differences of note are on line 34 and 35.</p>
<p>On line 34, we set a default for the number of Fibonacci numbers to generate, by utilizing a special feature of symbols - you can use them as a function, passing a map as the first parameter. This looks up the value for that symbol in the mapping. You can pass a second parameter, which will be returned if the symbol isn't a key in the map - essentially a default value.</p>
<p>Finally, line 35 sets a variable called <tt class="docutils literal">note</tt> using the <tt class="docutils literal">if</tt> form - if the user has passed <tt class="docutils literal"><span class="pre">-g</span></tt> and <tt class="docutils literal">golden</tt> is true, then we'll print <tt class="docutils literal">[golden]</tt> to indicate the golden ratio-based function is in use. Otherwise, we'll print <tt class="docutils literal">[recursive]</tt> to indicate the standard recursive function is in use.</p>
</div>
<p>Now you can see what options are available, and tell the script what to do:</p>
<div class="highlight"><pre><span></span><span class="gp">$</span> ./fib.boot -h
<span class="go">Print a fibonacci sequence to stdout using one of two algorithms.</span>

<span class="go">Options:</span>
<span class="go"> -h, --help Print this help info.</span>
<span class="go"> -g, --golden Use the golden mean to calculate</span>
<span class="go"> -n, --number NUMBER Set quantity of numbers to generate. Defaults to 10.</span>

<span class="gp">$</span> ./fib.boot
<span class="go"> [recursive] Printing fibonacci sequence up to 10 numbers:</span>
<span class="go"> 0 1 1 2 3 5 8 13 21 34</span>

<span class="gp">$</span> ./fib.boot -g -n <span class="m">20</span>
<span class="go"> [golden] Printing fibonacci sequence up to 20 numbers:</span>
<span class="go"> 0 1 1 2 3 5 8 13 21 34 55 89 144 233 377 611 990 1604 2598 4209</span>
</pre></div>
</div>
</div>
<div class="section" id="working-at-the-pickle-factory-packing-java-jars-and-more-complex-projects">
<h3>Working At The Pickle Factory (Packing Java Jars and More Complex Projects)</h3>
<p>Now that we've got a basic feel for Clojure and using boot, we can build a project, that creates a library with an entry point that we can use and distribute as a jar file. This opens the doors to being able to deploy web applications, build libraries to share, and distribute standalone application bundles.</p>
<div class="section" id="project-structure">
<h4>Project Structure</h4>
<p>First, we need to create a project structure. This will help us keep things organized, and fit in with the way Clojure handles namespaces and files. We'll put our source code in <tt class="docutils literal">src</tt>, and create a new namespace, called <tt class="docutils literal">fib.core</tt>:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="gp">$</span> mkdir -p src/fib
</pre></div>
</td></tr></table><p>In <tt class="docutils literal">src/fib/core.clj</tt>, we'll declare our new namespace:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="p">(</span><span class="kd">ns </span><span class="nv">fib.core</span>
   <span class="p">(</span><span class="ss">:require</span> <span class="p">[</span><span class="nv">clojure.math.numeric-tower</span> <span class="ss">:refer</span> <span class="p">[</span><span class="nv">expt</span> <span class="nv">round</span> <span class="nv">sqrt</span><span class="p">]]</span>
             <span class="p">[</span><span class="nv">boot.cli</span> <span class="ss">:as</span> <span class="nv">cli</span><span class="p">])</span>
   <span class="p">(</span><span class="ss">:gen-class</span><span class="p">))</span>

<span class="p">(</span><span class="k">def </span><span class="nv">phi</span> <span class="p">(</span><span class="nb">/ </span><span class="p">(</span><span class="nb">+ </span><span class="p">(</span><span class="nf">sqrt</span> <span class="mi">5</span><span class="p">)</span> <span class="mi">1</span><span class="p">)</span> <span class="mi">2</span><span class="p">))</span>

<span class="p">(</span><span class="kd">defn </span><span class="nv">fib</span>
   <span class="p">([</span><span class="nv">n</span><span class="p">]</span>
     <span class="p">(</span><span class="nf">fib</span> <span class="p">[</span><span class="mi">0</span> <span class="mi">1</span><span class="p">]</span> <span class="nv">n</span><span class="p">))</span>
   <span class="p">([</span><span class="nv">pair</span>, <span class="nv">n</span><span class="p">]</span>
      <span class="p">(</span><span class="nb">print </span><span class="p">(</span><span class="nb">str </span><span class="p">(</span><span class="nb">first </span><span class="nv">pair</span><span class="p">)</span> <span class="s">" "</span><span class="p">))</span>
      <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">&gt; </span><span class="nv">n</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">(</span><span class="nf">fib</span> <span class="p">[(</span><span class="nb">second </span><span class="nv">pair</span><span class="p">)</span> <span class="p">(</span><span class="nb">apply + </span><span class="nv">pair</span><span class="p">)]</span> <span class="p">(</span><span class="nb">- </span><span class="nv">n</span> <span class="mi">1</span><span class="p">)))))</span>

<span class="p">(</span><span class="kd">defn </span><span class="nv">fibgolden</span>
   <span class="p">[</span><span class="nv">n</span><span class="p">]</span>
   <span class="p">(</span><span class="k">loop </span><span class="p">[</span><span class="nv">counter</span> <span class="mi">0</span><span class="p">]</span>
     <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">= </span><span class="nv">counter</span> <span class="mi">0</span><span class="p">)</span>
       <span class="p">(</span><span class="nf">do</span>
         <span class="p">(</span><span class="nb">print </span><span class="p">(</span><span class="nb">str </span><span class="mi">0</span> <span class="s">" "</span> <span class="mi">1</span> <span class="s">" "</span> <span class="mi">1</span> <span class="s">" "</span><span class="p">))</span>
         <span class="p">(</span><span class="nf">recur</span> <span class="mi">3</span><span class="p">))</span>
     <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">f</span> <span class="p">(</span><span class="nf">round</span> <span class="p">(</span><span class="nb">/ </span><span class="p">(</span><span class="nf">expt</span> <span class="nv">phi</span> <span class="nv">counter</span><span class="p">)</span> <span class="p">(</span><span class="nf">sqrt</span> <span class="mi">5</span><span class="p">)))]</span>
       <span class="p">(</span><span class="nb">print </span><span class="p">(</span><span class="nb">str </span><span class="nv">f</span> <span class="s">" "</span><span class="p">))</span>
       <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">&lt; </span><span class="nv">counter</span> <span class="p">(</span><span class="nb">- </span><span class="nv">n</span> <span class="mi">1</span><span class="p">))</span>
         <span class="p">(</span><span class="nf">recur</span> <span class="p">(</span><span class="nb">+ </span><span class="nv">counter</span> <span class="mi">1</span><span class="p">)))))))</span>

<span class="p">(</span><span class="nf">cli/defclifn</span> <span class="nv">-main</span>
   <span class="s">"Print a Fibonacci sequence to stdout using one of two algorithms."</span>
   <span class="p">[</span><span class="nv">g</span> <span class="nv">golden</span> <span class="nv">bool</span> <span class="s">"Use the golden mean to calculate"</span>
    <span class="nv">n</span> <span class="nv">number</span> <span class="nv">NUMBER</span> <span class="nb">int </span><span class="s">"Quantity of numbers to generate. Defaults to 10"</span><span class="p">]</span>
   <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">n</span> <span class="p">(</span><span class="ss">:number</span> <span class="nv">*opts*</span> <span class="mi">10</span><span class="p">)</span>
         <span class="nv">note</span> <span class="p">(</span><span class="k">if </span><span class="nv">golden</span> <span class="s">"[golden]"</span> <span class="s">"[recursive]"</span><span class="p">)]</span>
     <span class="p">(</span><span class="nb">println </span><span class="nv">note</span> <span class="s">"Printing Fibonacci sequence up to"</span> <span class="nv">n</span> <span class="s">"numbers:"</span><span class="p">)</span>
     <span class="p">(</span><span class="k">if </span><span class="nv">golden</span>
       <span class="p">(</span><span class="nf">fibgolden</span> <span class="nv">n</span><span class="p">)</span>
       <span class="p">(</span><span class="nf">fib</span> <span class="nv">n</span><span class="p">)))</span>
     <span class="p">(</span><span class="nf">println</span><span class="p">))</span>
</pre></div>
</td></tr></table><div class="explanation section">
<h5>Explanation</h5>
<div class="docutils container">
</div>
<p>Our module is identical to our boot script, except for the following:</p>
<ul class="simple">
<li>On line 1 we declare a <a class="reference external" href="https://clojure.org/reference/namespaces">namespace</a> (<a class="reference external" href="https://www.braveclojure.com/organization/">more info</a>). <tt class="docutils literal">ns</tt> allows us to bring in libraries using the <tt class="docutils literal">:require</tt> parameter (line 2). The syntax is just like the <tt class="docutils literal">require</tt> function, except that you don't have to prefix the module name with a <a class="reference external" href="https://clojure.org/guides/weird_characters#__code_code_var_quote">var quote</a>.</li>
</ul>
<p>We use the <tt class="docutils literal"><span class="pre">:gen-class</span></tt> parameter to tell clojure to generate proper Java classes for our namespace when compiling. This allows us to use our compiled jar file like any old Java jar. <a class="reference external" href="https://clojure.org/reference/compilation">More info</a>.</p>
</div>
<p>To build our jar, there are a handful of steps:</p>
<ol class="arabic simple">
<li>Download our dependencies.</li>
<li>Compile our clojure code ahead of time (aka <a class="reference external" href="http://clojure.org/compilation">AOT</a>).</li>
<li>Add a <a class="reference external" href="http://maven.apache.org/pom.html">POM</a> file describing our project and the version.</li>
<li>Scan all of our dependencies and add them to the fileset to be put into the jar.</li>
<li>Build the jar, specifying a module containing a -main function to run when the jar is invoked.</li>
</ol>
<p>Helpfully, boot provides built-in functionality to do this for us. Each step is implemented as a boot <a class="reference external" href="https://github.com/boot-clj/boot/wiki/Tasks">task</a>. Tasks act as a pipeline: the result of each can influence the next.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="gp">$</span> boot -d org.clojure/clojure <span class="se">\</span>
       -d boot/core <span class="se">\</span>
       -d boot/base <span class="se">\</span>
       -d org.clojure/math.numeric-tower:0.0.4 <span class="se">\</span>
       -s src/ <span class="se">\</span>
       aot -a <span class="se">\</span>
       pom -p fib -v <span class="m">1</span>.0.0 <span class="se">\</span>
       uber <span class="se">\</span>
       jar -m fib.core <span class="se">\</span>
       target
</pre></div>
</td></tr></table><p>A brief explanation of each task and command line options:</p>
<blockquote>
<p><strong>Line 1-4:</strong> the <tt class="docutils literal"><span class="pre">-d</span></tt> option specifies a dependency. Here we list   Clojure itself, <tt class="docutils literal">boot.core</tt>, <tt class="docutils literal">boot.base</tt> and <tt class="docutils literal"><span class="pre">math.numeric-tower</span></tt>.</p>
<p><strong>Line 5:</strong> <tt class="docutils literal"><span class="pre">-s</span></tt> specifies a source directory to look into for <tt class="docutils literal">.clj</tt> files.</p>
<p><strong>Line 6:</strong> this is the AOT task, that compiles all of the <tt class="docutils literal">.clj</tt> files for us. The <tt class="docutils literal"><span class="pre">-a</span></tt> flag tells the task to compile everything it finds.</p>
<p><strong>Line 7:</strong> the POM task. This task adds project information to the jar. The <tt class="docutils literal"><span class="pre">-p</span></tt> option specifies the project name, <tt class="docutils literal"><span class="pre">-v</span></tt> is the version.</p>
<p><strong>Line 8:</strong> the uber task collects the dependencies so they can be baked into the jar file. This makes the jar big (huge really), but it ends up being self-contained.</p>
<p><strong>Line 9:</strong> the jar task. This is the task that actually generates the jar file. The <tt class="docutils literal"><span class="pre">-m</span></tt> option specifies which module has the <tt class="docutils literal"><span class="pre">-main</span></tt> function.</p>
<p><strong>Line 10:</strong> the <code>target</code> task. This task writes out the product of the other tasks to the target directory (<code>./target</code> by default).</p>
</blockquote>
<p>Running the above command, produces output something like this:</p>
<div class="highlight"><pre><span></span>$ boot -d "org.clojure/clojure" \
       -d "boot/core" \
       -d "boot/base" \
       -d "org.clojure/math.numeric-tower:0.0.4" \
       -s src/ \
       aot -a \
       pom -p fib -v 1.0.0 \
       uber \
       jar -m fib.core \
       target

Retrieving core-2.0.0-rc8.pom from https://repo.clojars.org/ (3k)
Retrieving pod-2.0.0-rc8.pom from https://repo.clojars.org/ (4k)
Retrieving core-2.0.0-rc8.jar from https://repo.clojars.org/ (671k)
Retrieving pod-2.0.0-rc8.jar from https://repo.clojars.org/ (878k)
Classpath conflict: org.clojure/clojure version 1.7.0 already loaded, NOT loading version 1.6.0
Compiling 1/1 fib.core...
Adding uberjar entries...
Writing fib-1.0.0.jar...
Writing target dir(s)...
</pre></div>
<p>At this point, there is a file named <tt class="docutils literal"><span class="pre">fib-1.0.0.jar</span></tt> in the <tt class="docutils literal">target</tt> directory. We can use the <tt class="docutils literal">java</tt> command to run it:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="gp">$</span> java -jar target/fib-1.0.0.jar
<span class="go">[recursive] Printing fibonacci sequence up to 10 numbers:</span>
<span class="go">0 1 1 2 3 5 8 13 21 34</span>
<span class="gp">$</span> java -jar target/fib-1.0.0.jar -g -n <span class="m">20</span>
<span class="go">[golden] Printing Fibonacci sequence up to 20 numbers:</span>
<span class="go">0 1 1 2 3 5 8 13 21 34 55 89 144 233 377 610 987 1597 2584 4181</span>
</pre></div>
</td></tr></table><p>You can send this file to a friend, and they can use it too.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">At time of writing, the <tt class="docutils literal"><span class="pre">-h</span></tt> flag, that usually displays help info, is not working in the jar file. I think it's because the <tt class="docutils literal">java</tt> command is "swallowing" it.</p>
</div>
</div>
</div>
<div class="section" id="introducing-build-boot">
<h3>Introducing build.boot</h3>
<p>At this point we have a project and can build a standalone jar file from it. This is great, but long command lines are prone to error. Boot provides a mechanism for defining your own tasks and setting the command line options in a single file, named <tt class="docutils literal">build.boot</tt>. Here's a <tt class="docutils literal">build.boot</tt> that configures boot in a manner equivalent to the command line switches above:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">set-env!</span> <span class="ss">:dependencies</span> <span class="o">'</span><span class="p">[[</span><span class="nv">org.clojure/math.numeric-tower</span> <span class="s">"0.0.4"</span><span class="p">]</span>
                           <span class="p">[</span><span class="nv">boot/core</span> <span class="s">"2.7.2"</span><span class="p">]</span>
                           <span class="p">[</span><span class="nv">boot/base</span> <span class="s">"2.7.2"</span><span class="p">]</span>
                           <span class="p">[</span><span class="nv">org.clojure/clojure</span> <span class="s">"1.8.0"</span><span class="p">]]</span>
          <span class="ss">:source-paths</span> <span class="o">#</span><span class="p">{</span><span class="s">"src/"</span><span class="p">})</span>

<span class="p">(</span><span class="nf">task-options!</span>
  <span class="nv">pom</span> <span class="p">{</span><span class="ss">:project</span> <span class="ss">'fib</span>
       <span class="ss">:version</span> <span class="s">"1.0.0"</span><span class="p">}</span>
  <span class="nv">jar</span> <span class="p">{</span><span class="ss">:main</span> <span class="ss">'fib.core</span><span class="p">}</span>
  <span class="nv">aot</span> <span class="p">{</span><span class="ss">:all</span> <span class="nv">true</span><span class="p">})</span>
</pre></div>
</td></tr></table><div class="explanation section">
<h4>Explanation</h4>
<div class="docutils container">
</div>
<p><tt class="docutils literal">build.boot</tt> is analogous to a <tt class="docutils literal">Makefile</tt> or <a class="reference external" href="https://ant.apache.org/">Apache Ant</a> build file - it acts a a robust configuration file with declarative syntax that tells the build tools what to do.</p>
<p><tt class="docutils literal"><span class="pre">set-env!</span></tt> was introduced earlier, here's the new concepts introduced:</p>
<ul>
<li><p class="first">We have to specify the precise versions of our dependencies here - this might seem tedious, but it's best to <em>always</em> do this, even with things we take for granted like clojure itself and boot. This way, our code will always be explicitly telling any users which versions its compatible with, and we won't get any surprises.</p>
<p>Most of the time, you'll know the version number you're using from clojars, but for boot and clojure itself, it might have been a while since you isntalled, and you may not remember.</p>
<p>To find out the boot and clojure version number, we can ask <tt class="docutils literal">boot</tt>:</p>
<div class="highlight"><pre><span></span><span class="gp">$</span> boot -V
<span class="gp">#</span>http://boot-clj.com
<span class="gp">#</span>Tue May <span class="m">15</span> <span class="m">14</span>:27:28 EDT <span class="m">2018</span>
<span class="go">BOOT_CLOJURE_NAME=org.clojure/clojure</span>
<span class="go">BOOT_CLOJURE_VERSION=1.8.0</span>
<span class="go">BOOT_VERSION=2.7.2</span>
</pre></div>
</li>
<li><p class="first">The <tt class="docutils literal"><span class="pre">:source-paths</span></tt> setting is using a neat built-in data structure called a <a class="reference external" href="https://clojure.org/reference/data_structures#Sets">hash set</a>. It's a clever way of handling a sequence of values that come from multiple sources but need to be unique - the data structure handles duplicates transparently so you don't have to think about it. This comes at a slight performance cost in most cases (compared to a hashmap or "dumb" sequence like an array or vector), but it also adds some interesting features like efficient unions and diffs.</p>
</li>
<li><p class="first">On line 7, we use the <tt class="docutils literal"><span class="pre">task-options!</span></tt> macro to take the place of specifying task options on the command line. The keys for each setting correspond to the "long form" of the given option. You can see these using the built-in help:</p>
<blockquote>
<div class="highlight"><pre><span></span><span class="gp">$</span> boot pom -h

<span class="go">Create project pom.xml file.</span>

<span class="go">The project and version must be specified to make a pom.xml.</span>

<span class="go">Options:</span>
<span class="go">  -h, --help                   Print this help info.</span>
<span class="go">  -p, --project SYM            SYM sets the project id (eg. foo/bar).</span>
<span class="go">  -v, --version VER            VER sets the project version.</span>
<span class="go">  -d, --description DESC       DESC sets the project description.</span>
<span class="go">  -c, --classifier STR         STR sets the project classifier.</span>
<span class="go">  -P, --packaging STR          STR sets the project packaging type, i.e. war, pom.</span>
<span class="go">  -u, --url URL                URL sets the project homepage url.</span>
<span class="go">  -s, --scm KEY=VAL            Conj [KEY VAL] onto the project scm map (KEY is one of url, tag, connection, developerConnection).</span>
<span class="go">  -l, --license NAME:URL       Conj [NAME URL] onto the map {name url} of project licenses.</span>
<span class="go">  -o, --developers NAME:EMAIL  Conj [NAME EMAIL] onto the map {name email} of project developers.</span>
<span class="go">  -D, --dependencies SYM:VER   Conj [SYM VER] onto the project dependencies vector (overrides boot env dependencies).</span>
</pre></div>
<p>As you can see, the <tt class="docutils literal"><span class="pre">-v</span></tt> parameter corresponds to <tt class="docutils literal"><span class="pre">--version</span></tt>, and <tt class="docutils literal"><span class="pre">-p</span></tt> to <tt class="docutils literal"><span class="pre">--project</span></tt>. Hence we use <tt class="docutils literal">:version</tt> and <tt class="docutils literal">:project</tt> in <tt class="docutils literal"><span class="pre">task-options!</span></tt>.</p>
<p>You will have to use a little intutition to figure out what <em>data type</em> the command wants, or you can always look at <a class="reference external" href="https://github.com/boot-clj/boot/blob/de1b9876b4485b23b25614dd4b4a528d0931ccda/boot/core/src/boot/task/built_in.clj#L534">the source</a>:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nv">...</span>
<span class="p">(</span><span class="nf">core/deftask</span> <span class="nv">pom</span>
  <span class="s">"Create project pom.xml file.</span>
<span class="s">  The project and version must be specified to make a pom.xml.</span>
<span class="s">  Note that if you want to install some other artifact along with the main one,</span>
<span class="s">  for instance the classic sources or javadoc artifact, you have to add the</span>
<span class="s">  classifier to your pom.xml, which translates to adding :classifier to this</span>
<span class="s">  task."</span>

  <span class="p">[</span><span class="nv">p</span> <span class="nb">project </span><span class="nv">SYM</span>           <span class="nv">sym</span>           <span class="s">"The project id (eg. foo/bar)."</span>
   <span class="nv">v</span> <span class="nv">version</span> <span class="nv">VER</span>           <span class="nb">str </span>          <span class="s">"The project version."</span>
   <span class="nv">d</span> <span class="nv">description</span> <span class="nv">DESC</span>      <span class="nb">str </span>          <span class="s">"The project description."</span>
   <span class="nv">c</span> <span class="nv">classifier</span> <span class="nv">STR</span>        <span class="nb">str </span>          <span class="s">"The project classifier."</span>
   <span class="nv">P</span> <span class="nv">packaging</span> <span class="nv">STR</span>         <span class="nb">str </span>          <span class="s">"The project packaging type, i.e. war, pom"</span>
   <span class="nv">u</span> <span class="nv">url</span> <span class="nv">URL</span>               <span class="nb">str </span>          <span class="s">"The project homepage url."</span>
   <span class="nv">s</span> <span class="nv">scm</span> <span class="nv">KEY=VAL</span>           <span class="p">{</span><span class="nv">kw</span> <span class="nv">str</span><span class="p">}</span>      <span class="s">"The project scm map (KEY is one of url, tag, connection, developerConnection)."</span>
   <span class="nv">l</span> <span class="nv">license</span> <span class="nv">NAME</span><span class="ss">:URL</span>      <span class="p">{</span><span class="nb">str </span><span class="nv">str</span><span class="p">}</span>     <span class="s">"The map {name url} of project licenses."</span>
   <span class="nv">o</span> <span class="nv">developers</span> <span class="nv">NAME</span><span class="ss">:EMAIL</span> <span class="p">{</span><span class="nb">str </span><span class="nv">str</span><span class="p">}</span>     <span class="s">"The map {name email} of project developers."</span>
   <span class="nv">D</span> <span class="nv">dependencies</span> <span class="nv">SYM</span><span class="ss">:VER</span>  <span class="p">[[</span><span class="nv">sym</span> <span class="nv">str</span><span class="p">]]</span>   <span class="s">"The project dependencies vector (overrides boot env dependencies)."</span>
   <span class="nv">a</span> <span class="nv">parent</span> <span class="nv">SYM</span><span class="ss">:VER=PATH</span> <span class="p">[</span><span class="nv">sym</span> <span class="nb">str </span><span class="nv">str</span><span class="p">]</span> <span class="s">"The project dependency vector of the parent project, path included."</span><span class="p">]</span>
<span class="nv">...</span>
</pre></div>
</td></tr></table><p>On line 9, we see that the <tt class="docutils literal">project</tt> argument is a symbol - this is why we prefix it with a var quote in <tt class="docutils literal">build.boot</tt>.</p>
</blockquote>
</li>
</ul>
</div>
<p>With <tt class="docutils literal">build.boot</tt> in the current directory, you can now run the tasks like this:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="gp">$</span> boot aot pom uber jar target
<span class="go">Compiling fib.core...</span>
<span class="go">Writing pom.xml and pom.properties...</span>
<span class="go">Adding uberjar entries...</span>
<span class="go">Writing fib-1.0.0.jar...</span>
<span class="go">Writing target dir(s)...</span>
</pre></div>
</td></tr></table><p>The convenience of <tt class="docutils literal">build.boot</tt> one step further, we can chain the tasks we want to use into our own task, using the <tt class="docutils literal">deftask</tt> macro:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">set-env!</span> <span class="ss">:dependencies</span> <span class="o">'</span><span class="p">[[</span><span class="nv">org.clojure/math.numeric-tower</span> <span class="s">"0.0.4"</span><span class="p">]</span>
                           <span class="p">[</span><span class="nv">boot/core</span> <span class="s">"2.7.2"</span><span class="p">]</span>
                           <span class="p">[</span><span class="nv">boot/base</span> <span class="s">"2.7.2"</span><span class="p">]</span>
                           <span class="p">[</span><span class="nv">org.clojure/clojure</span> <span class="s">"1.8.0"</span><span class="p">]]</span>
          <span class="ss">:source-paths</span> <span class="o">#</span><span class="p">{</span><span class="s">"src/"</span><span class="p">})</span>

<span class="p">(</span><span class="nf">task-options!</span>
  <span class="nv">pom</span> <span class="p">{</span><span class="ss">:project</span> <span class="ss">'fib</span>
       <span class="ss">:version</span> <span class="s">"1.0.0"</span><span class="p">}</span>
  <span class="nv">jar</span> <span class="p">{</span><span class="ss">:main</span> <span class="ss">'fib.core</span><span class="p">}</span>
  <span class="nv">aot</span> <span class="p">{</span><span class="ss">:all</span> <span class="nv">true</span><span class="p">})</span>

<span class="p">(</span><span class="nf">deftask</span> <span class="nv">build</span>
 <span class="s">"Create a standalone jar file that computes Fibonacci sequences."</span>
 <span class="p">[]</span>
 <span class="p">(</span><span class="nb">comp </span><span class="p">(</span><span class="nf">aot</span><span class="p">)</span> <span class="p">(</span><span class="nf">pom</span><span class="p">)</span> <span class="p">(</span><span class="nf">uber</span><span class="p">)</span> <span class="p">(</span><span class="nf">jar</span><span class="p">)</span> <span class="p">(</span><span class="nf">target</span><span class="p">)))</span>
</pre></div>
</td></tr></table><p>Now, we can just run <tt class="docutils literal">boot build</tt> to make our standalone jar file. You'll also see your task show up in the help output:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="gp">$</span> boot -h
<span class="go">...</span>
<span class="go">build Create a standalone jar file that computes Fibonacci sequences.</span>
<span class="go">...</span>
<span class="gp">$</span> boot build
<span class="go">Compiling fib.core...</span>
<span class="go">Writing pom.xml and pom.properties...</span>
<span class="go">Adding uberjar entries...</span>
<span class="go">Writing fib-1.0.0.jar...</span>
<span class="go">Writing target dir(s)...</span>
</pre></div>
</td></tr></table></div>
<div class="section" id="where-to-go-from-here">
<h3>Where To Go From Here</h3>
<p>At this point we've touched most of the awesomeness that boot gives us. With these basic tools, there's all sorts of interesting things we can do next. Here are some ideas:</p>
<ul class="simple">
<li>Use boot instead of a "typical" scripting language for systems automation.</li>
<li>Distribute single <code>.boot</code> files containing entire applications.</li>
<li>Build WAR files and use other <a class="reference external" href="https://github.com/boot-clj/boot/wiki/Community-Tasks">boot tasks provided by the community</a>to do all sorts of cool things, like <a class="reference external" href="https://github.com/mathias/boot-sassc">compile SASS     templates</a> and <a class="reference external" href="https://github.com/adzerk/boot-beanstalk">deploy to Amazon Elastic Beanstalk</a>.</li>
<li>Write your own, specialized tasks to help streamline complex build     processes - boot can replace (or augment) tools like     <a class="reference external" href="http://ant.apache.org/">ant</a> and     <a class="reference external" href="http://www.gnu.org/software/make/">make</a>.</li>
</ul>
</div>
</div>
<div class="section" id="appendix-alternative-install-methods">
<h2 id="appendix-alternative-install-methods">Appendix: Alternative Install Methods</h2>
<p>Recent versions of boot are now available for homebrew, nix, and docker. More details <a class="reference external" href="https://github.com/boot-clj/boot#install">here</a>.</p>
</div>

  </div><!-- /.entry-content -->
</section>
        </div>
        <footer id="contentinfo" class="body">
            <div id="footer-text-wrapper">
                <div id="footer-text">&copy; 2018 Josh Johnson. All Rights Reserved. <a href="/pages/about.html">About</a></div>
            </div>
        </footer>
        <script src="/theme/js/main.js"></script>
</body>
</html>